# Эпоха Поселений (Epoch Settlements) - Godot 4.x

## Обзор
Мультиплеерная и одиночная 3D игра с видом от первого лица, сочетающая выживание, строительство, боевую систему, экономику и управление поселениями. Построена на Godot 4.4.1.

## Структура проекта

### Основные директории
- **scenes/** - Сцены Godot (.tscn)
  - `ui/` - Интерфейс (HUD, инвентарь, крафт, торговля, настройки, миникарта)
  - `player/` - Сцена игрока
  - `mobs/` - Сцены мобов
  - `npcs/` - Сцены NPC
  - `buildings/` - Строения
  - `props/` - Пропы, оружие, животные
  - `world/` - Генерация мира

- **scripts/** - GDScript код (.gd)
  - `systems/` - Ядровые системы (инвентарь, сеть, бой, крафт, настройки и т.д.)
  - `world/` - Генерация мира (WorldGenerator, ChunkGenerator, StructureGenerator, MobSpawner, WorldEvents)
  - `ai/` - ИИ поведение (монстры, волки, NPC)
  - `combat/` - Боевая система
  - `ui/` - Контроллеры интерфейса (hud_controller, ui_inventory, minimap)
  - `player/` - Скрипты игрока

- **assets/** - Игровые ассеты
  - `art_pack/` - 3D модели, материалы, текстуры
  - `materials/` - Ресурсы материалов (grass, rock, bark, water)
  - `shaders/` - Шейдеры (grass_shader, water_shader)
  - `weapons/` - Ресурсы оружия

- **localization/** - Локализация (RU/EN)

## Реализованные системы

### UI Интерфейс (NEW)
- **HUD** - Полный интерфейс с:
  - Панель статов (здоровье, стамина, голод, жажда, кровь, рассудок, температура)
  - 8 слотов быстрого пояса (хотбар) с визуальным выделением
  - Прицел и индикатор приседания
  - Уведомления об опыте и уровне
  - Индикатор прыжков
  - FPS счётчик
  
- **Миникарта** - В правом верхнем углу
  - Отображение биомов
  - Маркер игрока с направлением
  - Компас (С, СВ, В, ЮВ, Ю, ЮЗ, З, СЗ)
  
- **Инвентарь** - Открывается клавишей I
  - Сетка предметов с названиями и количеством
  - Отображение веса
  - Кнопки использования предметов
  - Начальный набор предметов при старте

### Генерация мира
- **WorldGenerator** - процедурная генерация высот и биомов на основе шума
  - Горы, холмы, равнины, овраги
  - Континенты и океаны
  - Реки через специальный шум
  - 12+ биомов: лес, тайга, тундра, пустыня, саванна, болото, горы, снежные горы, пляж, океан и др.
  
- **ChunkGenerator** - генерация 3D мешей террейна
  - Высотные карты с коллизиями
  - Цвета вершин по биомам
  - Автоматический спавн деревьев и камней
  - Водная поверхность для морей/рек
  
- **StructureGenerator** - генерация поселений
  - Деревни (3-8 зданий + NPC)
  - Города (с стенами, 10-30 зданий, охрана)
  - Шахты (входы, поддержки, шахтёры)
  - Лагеря (палатки, костры, бандиты/нейтралы)
  
- **WorldStreamer** - потоковая загрузка
  - Динамическая загрузка/выгрузка чанков вокруг игрока
  - Отдельная загрузка структур
  
- **MobSpawner** - динамический спавн существ
  - 19 типов мобов (волки, медведи, кабаны, олени, пауки, змеи, львы и др.)
  - Таблицы спавна по биомам
  - Стайное поведение (pack_size)
  - Автоматический деспавн далёких мобов

- **WorldEvents** - случайные события мира
  - Налёты бандитов
  - Волчьи стаи
  - Миграция животных
  - Появление монстров
  - Торговые караваны

### Выживание (PlayerProgression)
- HP, Stamina, Hunger, Thirst, Temperature, Sanity, Blood
- Дебаффы и штрафы за смерть
- Восстановление здоровья и статов
- Система XP и уровней

### Инвентарь (inventory.gd)
- 40 слотов рюкзака + система веса
- 8 слотов быстрого пояса (hotbar) с выбором клавишами 1-8
- 8 слотов снаряжения
- База данных предметов с русскими названиями
- Система использования предметов (еда, питьё, медикаменты)
- Начальный набор: каменный топор, факел, ягоды, вода, бинты, дерево, камни

### Боевая система (CombatEngine)
- Hitbox-based урон
- Ресурсы оружия
- Система комбо
- Расчёт брони
- Поддержка снарядов

### Система фракций (FactionSystem)
- Дефолтные фракции: player, town, wild, bandits, monsters, neutral
- Отношения между фракциями (-100 до +100)
- Регистрация/отмена регистрации сущностей

### Поселения (SettlementSystem)
- Уровни: Camp → Village → Town → City → Capital
- Население с классами (workers, guards, craftsmen, traders)
- Ресурсы и экономика
- Счастье населения
- Объявление войн и союзов

### Настройки (SettingsManager)
- Графика: качество, разрешение, тени, свечение, туман, сглаживание
- Управление: чувствительность мыши, FOV, инверсия Y
- Звук: громкость (общая, музыка, эффекты)
- Пресеты качества: низкое, среднее, высокое, ультра

## Управление
- **WASD** - движение
- **Space** - прыжок (двойной прыжок)
- **Shift** - бег
- **Ctrl** - присесть
- **E** - взаимодействие
- **I** - инвентарь
- **1-8** - выбор слота хотбара
- **Колёсико мыши** - переключение слотов
- **ЛКМ** - атака
- **ESC** - меню

## Запуск
Игра запускается через VNC workflow в Replit. Главная сцена: `scenes/ui/main_menu.tscn`

## Технические детали
- Движок: Godot 4.4.1
- Рендеринг: OpenGL ES 3.2 (compatibility mode)
- Мультиплеер: клиент-серверная архитектура
- Генерация мира: FastNoiseLite, чанковый стриминг
- Размер мира: 4096x4096 единиц

## Последние изменения (2025-11-29)
- **Система дебаффов** - Полная система дебаффов с 12+ эффектами:
  - Голодание, обезвоживание, замерзание, перегрев
  - Кровотечение, истощение, безумие
  - Отравление, радиация
  - Положительные эффекты: сытость, увлажнённость
- **Цикл дня/ночи** - Динамическая смена времени суток:
  - Реалистичное освещение (рассвет, день, сумерки, ночь)
  - Изменение цвета неба и окружения
  - Отображение времени в HUD
- **Расширенная система крафта**:
  - 60+ рецептов в 9 категориях
  - Инструменты, оружие, строительство, броня, еда, медицина
  - Верстаки 3 уровней
- **Расширенная база предметов** - 100+ предметов с русскими названиями
- **Улучшенная погодная система**:
  - 8 типов погоды (ясно, облачно, дождь, ливень, снег, метель, гроза, туман)
  - Влияние на температуру и видимость
  - Переходы между погодными условиями
- **Улучшенный визуальный стиль**:
  - Реалистичное освещение с тремя источниками света
  - Улучшенный туман и свечение
  - Тональная коррекция в стиле Rust

## Минимальные требования
- Процессор: Intel Core i3 или аналог
- ОЗУ: 2 GB
- Графика: Совместимая с OpenGL ES 3.2

## Предпочтения пользователя
- Язык: русский
- Качество графики: сравнимое с Rust
